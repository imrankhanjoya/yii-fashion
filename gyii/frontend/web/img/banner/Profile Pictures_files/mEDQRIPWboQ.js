if (self.CavalryLogger) { CavalryLogger.start_js(["xICvh"]); }

__d("MFriendRequestImpressionLogger",["DataStore","DOM","MarauderLogger","MFriendRequestIHEventLogger","MViewport","Stratcom","Vector","debounceCore","ge"],(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){__p&&__p();var p,q=0,r;function a(a){r=a,p=o("friends_center_main"),p&&(s(),l.listen("scroll",null,n(s,100)))}function s(){var a=h.scry(p,"div","undoable-action"),b=k.getScrollPos().y+k.getHeight();while(q<a.length){var c=a[q],d=m.getElementPosition(c).y+m.getElementDimensions(c).y;if(d<=b)t(c),q+=1;else break}}function t(a){a=g.get(a,"userid");a&&(i.log("request_seen","friend_request_waterfall",{request_id:a,request_location:r}),j.logImpression(a?a.toString():null))}e.exports={setup:a}}),null);
__d("MFriendsCenter",["AsyncSignal","CSS","DOM","MLegacyDataStore","MPageCache","MPageControllerPath","Stratcom","cx","getActiveElement","FWLoader"],(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){__p&&__p();var p=b("FWLoader").FW,q="friends-center-nav",r="friends-center-nav-item";b="friends-center-filter-item";var s="requests-toggle-menu-sigil",t="m-friend-center-req-badge",u="friends_center_main",v="friends_center_loading",w="friends_center_search_box",x="friends-center-request-item",y="/friends/center/log_click";function a(a){B(),D(C()-1)}function z(a,b,c){a.forEach(function(a){h.conditionClass(a,c,!1)}),h.conditionClass(b,c,!0)}function A(a){for(var b=0;b<a.length;b++)if(m.hasSigil(a[b],"bubble-menu-main-option")){z(a,a[b],"_5vvb");return}}function c(event){__p&&__p();var a=event.getNode(q),b=event.getNode(r);if(!a||!b)return;var c="_510i";a=i.scry(a,"a");z(a,b,c);c=j.get(b).fc_key;c==="requests"&&(a=i.scry(document.body,"a",s),A(a));F();B()}function d(event){var a="_5vvb",b=event.getTarget(),c=i.scry(event.getTarget().parentNode,"a",s);z(c,b,a);F();B()}function B(){var a=l.getRequestPath();k.removeCachedPage(a);k.clearCachedIUIResponses(a)}function C(){var a=i.scry(document.body,"div",t);if(!a||!a.length)return 0;a=parseInt(a[0].firstChild.nodeValue,10);isNaN(a)&&(a=0);return a}function D(a){var b=i.scry(document.body,"div",t);if(!b||!b.length)return;a>0?i.setContent(b[0],""+a):b[0].parentNode.style.display="none"}function f(){var a=o();a&&a.blur();window.FW_ENABLED&&p.isAndroid()&&p.hideSoftKeyboard()}function n(a,b){var c=function(){window.FW_ENABLED&&p.openInNewWebView(a)};b=new g(y,{nav_item:b});b.listen("load",c);b.listen("fail",c);b.send()}function E(a){new g(y,{nav_item:a}).send()}function F(){var a=document.getElementById(u),b=document.getElementById(v);a&&i.hide(a);b&&i.show(b)}function G(){var a=document.getElementById(u),b=document.getElementById(v);b&&i.hide(b);a&&i.show(a)}function H(){var a=document.getElementById(u),b=document.getElementById(v);a=a.childNodes;for(var c=0;c<a.length;c++)a[c].id!==w&&i.hide(a[c]);b&&i.show(b)}m.listen("click",r,c);m.listen("click",b,F);m.listen("click",s,d);m.listen("m:optimistic-request-response:click",x,a);e.exports={hideSearchKeyboard:f,logAndOpenTab:n,logTabClick:E,showLoading:F,showSearchLoading:H,hideLoading:G,updateRequestsBadge:D}}),null);
__d("MOptimisticRequestResponse",["DOM","KaiOSSpatialNavEvents","MLegacyDataStore","MRequest","MURI","Stratcom"],(function(a,b,c,d,e,f,g,h,i,j,k,l){__p&&__p();function a(event){__p&&__p();var a,b;if(b=event.getNode("ignore-request"))a="ignore";else if(b=event.getNode("confirm-request"))a="confirm";else throw new Error("use ignore-request or confirm-request sigils for actions");b=i.get(b);if(!b||!b.optimistic_uri)throw new Error("add meta to buttons with optimistic_uri set");b.flyoutEvent&&(event=b.flyoutEvent);var c=m(event),d=i.get(c),e=d.optimistic_category;if(!e)throw new Error("set optimistic_category meta on root node to separate listeners for optimistic responses");var f=g.scry(c,"*","m-optimistic-response-action"),p=g.scry(c,"*","m-optimistic-response-confirm"),q=g.scry(c,"*","m-optimistic-response-ignore");b=new j(new k(b.optimistic_uri)).setData(b.optimistic_post_data||{}).setMethod("POST");var r={event:event,action:a,action_sections:f,confirm_sections:p,ignore_sections:q,root_node:c};b.listen("start",function(){l.invoke("m:requests:refresh"),l.invoke("m:optimistic-request-response:click",e,r),d.userid&&l.invoke("friending_state_change",null,{userid:d.userid,action:a}),l.invoke(h.REFRESH,null,null)});b.listen("postprocess",function(){l.invoke("m:requests:refresh"),l.invoke("m:optimistic-request-response:success",e,r)});b.listen("error",function(){o(f),n(p),n(q)});b.setFailureLogging("friend_response_"+a);b.send()}function m(event){var a=event.getNode("m-optimistic-response-root");if(!a)throw new Error("no parent element with m-optimistic-response-root sigil");return a}function n(a){a.forEach(function(a){g.hide(a)})}function o(a){a.forEach(function(a){g.show(a)})}l.listen("click","confirm-request",a);l.listen("click","ignore-request",a);e.exports={showAll:o,hideAll:n}}),null);
__d("MOptimisticFriendingResponse",["DOM","MFriendingActionError","MOptimisticRequestResponse","Stratcom"],(function(a,b,c,d,e,f,g,h,i,j){__p&&__p();function a(a,b,c){"use strict";this.id=a,this.userid=b,this.inJewel=c,this.listeners=[j.listen("friending_state_change",null,this.onFriendStateChange.bind(this)),j.listen("m:page:unload",null,this.cleanup.bind(this))]}a.prototype.onFriendStateChange=function(a){"use strict";__p&&__p();a=a.getData();if(a.userid!=this.userid)return;var b=document.getElementById(this.id);if(!b)return;var c=g.scry(b,"*","m-optimistic-response-action"),d=g.scry(b,"*","m-optimistic-response-confirm");b=g.scry(b,"*","m-optimistic-response-ignore");switch(a.error){case h.CONFIRM_INCOMING_REQUEST_ERROR:case h.DELETE_INCOMING_REQUEST_ERROR:i.showAll(c);i.hideAll(b);i.hideAll(d);return}i.hideAll(c);switch(a.action){case"confirm":i.showAll(d);i.hideAll(b);break;case"ignore":case"reject":i.showAll(b);i.hideAll(d);break;default:return}};a.prototype.cleanup=function(){"use strict";if(this.inJewel)return;for(var a=0;a<this.listeners.length;a++)this.listeners[a].remove();this.listeners=[]};e.exports=a}),null);
__d("XFriendCenterPYMKSurveyController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/friends/pymk/friendcenter/scroll/survey/",{})}),null);
__d("MFriendCenterPYMKSurveyHelper",["MFriendingState","MRequest","Stratcom","XFriendCenterPYMKSurveyController"],(function(a,b,c,d,e,f,g,h,i,j){__p&&__p();var k=20,l,m,n;function a(){l=0,m=!1,n||(n=i.listen([g.REQUEST_SENT],null,o))}function o(){m=!0}function b(){l+=1;if(l===k&&!m){var a=j.getURIBuilder().getURI();new h(a).send()}}e.exports={setup:a,increaseScrollCount:b}}),null);
__d("MPymkImpressionLogger",["DOM","MFriendCenterPYMKSurveyHelper","MPymkFunnelLogger","MViewport","Stratcom","Vector","debounceCore","ge"],(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){__p&&__p();var o,p,q,r,s,t,u,v;function a(a,b){b===void 0&&(b=!1),s=a,p=!0,r=0,o=n("friends_center_main"),o&&(v=k.listen("click","friends-center-nav-item",A),u=k.listen("click","m-xout-pymk-suggestions",w),b?(y(),t=k.listen("scroll",null,m(y,100))):(x(),t=k.listen("scroll",null,m(x,100))))}function w(){var a=g.scry(o,"div","undoable-action");r<a.length&&(z(a[r]),r+=1)}function x(){var a=g.scry(o,"div","undoable-action"),b=j.getScrollPos().y+j.getHeight();while(r<a.length){var c=a[r],d=l.getElementPosition(c).y+l.getElementDimensions(c).y;if(d<=b)z(c),r+=1;else break}}function y(){p&&(q=j.getScrollPos().y+j.getHeight(),p=!1);var a=g.scry(o,"div","undoable-action"),b=j.getScrollPos().y+j.getHeight();while(r<a.length){var c=a[r],d=l.getElementPosition(c).y+l.getElementDimensions(c).y;if(d<=b)r+=1,d>q&&(z(c),h.increaseScrollCount());else break}}function z(a){i.logImpression(a.getAttribute("data-pymk-id"),a.getAttribute("data-signature"),s)}function A(){t&&t.remove(),u&&u.remove(),v&&v.remove()}e.exports={setup:a}}),null);
__d("MXoutPYMKSuggestions",["CSS","DOM","KaiOSSpatialNavEvents","MPymkFunnelLogger","Parent","Stratcom","Style","csx"],(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){__p&&__p();var o="removed_item_hidden_event",p="/find-friends/index.php";function a(event){__p&&__p();var a=event.getNode("m-xout-pymk-suggestions");a=k.bySelector(a,"._5pxa");g.hide(a);l.invoke(i.REFRESH,null,null);l.invoke(o,null,null);var b=a.getAttribute("data-pymk-id"),c=a.getAttribute("data-pymk-loc");if(b&&c===p){a=a.getAttribute("data-signature");j.logXOut(b,a,c)}}function b(event){__p&&__p();var a=event.getNode("m-add-friend");if(!a)return;a=k.bySelector(a,"._5pxa");if(!a)return;a=h.scry(a,"*","m-xout-pymk-suggestions")[0];if(!a)return;m.apply(a,{visibility:"hidden"})}l.listen("click","m-add-friend",b);l.listen("click","m-xout-pymk-suggestions",a);e.exports={}}),null);
__d("MRequestsJewelFriendConfirmedNotif",["CSS","DOM","MRequest","MURI","Stratcom","cx"],(function(a,b,c,d,e,f,g,h,i,j,k,l){__p&&__p();a={_viewerID:null,_unseenNotifIDs:[],_notifMarkReadListener:null,_notifToggleListener:null,_slaves:null,_master:null,_slaveShown:!1,_unread:!1,_notifStatusSet:!1,updateUnseenNotifIDs:function(a,b,c){this._viewerID=b,this._unread=c,this._unseenNotifIDs=a,this._shown=!1,this._notifStatusSet=!1,this._notifMarkReadListener===null&&(this._notifMarkReadListener=k.listen("m_requests_jewel_mark_read",null,this.setNotifsRead.bind(this))),this._notifToggleListener===null&&(this._master===null&&(this._master=h.scry(document.body,"div","m_requests_jewel_accept_notif_master")[0]),this._slaves===null&&(this._slaves=h.scry(document.body,"div","m_requests_jewel_accept_notif_slave")[0]),this._notifToggleListener=k.listen("click","m_requests_jewel_accept_notif_master",function(){this._unread&&(g.removeClass(this._master,"_uss"),this._unread=!1),this._notifStatusSet||(this.setNotifsRead,this._notifStatusSet=!0),this._slaveShown&&this._slaves!==void 0?(g.hide(this._slaves),this._slaveShown=!1):(g.show(this._slaves),this._slaveShown=!0)}.bind(this)))},setNotifsRead:function(){if(this._notifStatusSet||this._unseenNotifIDs.length===0)return;var a=new i(new j("/a/jewel_notifications_read.php").toString());a.addData({ids:this._unseenNotifIDs,count:this._unseenNotifIDs.length,seen:!1});a.send();this._notifStatusSet=!0}};e.exports=a}),null);
__d("MRequestsJewelTitleBadge",["CSS","DataStore","DOM","Stratcom","ge"],(function(a,b,c,d,e,f,g,h,i,j,k){__p&&__p();var l="friends-center-request-item";a={friendingListener:null,init:function(){var a=k("m-jewel-requests-title-badge");if(a){var b=parseInt(h.get(a,"count"),10);b<=0&&g.hide(a)}a=k("m-friend-center-requests-title-badge");a&&(b=parseInt(h.get(a,"count"),10),b<=0&&g.hide(a));this.friendingListener||(this.friendingListener=j.listen("m:optimistic-request-response:click",l,this.decrementBadgeCounts))},updateAfterNewReqs:function(a){var b=k("m-jewel-requests-title-badge");b&&a>0&&(h.set(b,"count",a),g.show(b),i.setContent(b,a))},decrementBadgeCounts:function(a){a=k("m-jewel-requests-title-badge");if(a){var b=parseInt(h.get(a,"count"),10);b=Math.max(b,0)-1;h.set(a,"count",b);b>0?(g.show(a),i.setContent(a,b)):g.hide(a)}a=k("m-friend-center-requests-title-badge");a&&(b=parseInt(h.get(a,"count"),10),b=Math.max(b,0)-1,h.set(a,"count",b),b>0?(g.show(a),i.setContent(a,b)):g.hide(a))}};e.exports=a}),null);